package Controller;

import DTO.LoanDTO;
import Service.LoanCreateService;
import View.LoanCreateForm;

public class LoanCreateController extends BaseController {
	
	private LoanCreateForm view;
	private LoanCreateService createService;
	private LoanListingController parentController;
	
	public LoanCreateController(LoanListingController parentController) {
		super(new LoanCreateForm());
		this.parentController = parentController;
		this.authenticate();
	}
	
	@Override
	public void initController() {
		this.view = (LoanCreateForm)this.getView();
		this.view.getCreateButton().addActionListener(e -> handleBranchCreateAction());
		this.createService = new LoanCreateService();
	}
	
	private void handleBranchCreateAction() {
		LoanDTO LoanDTO = new LoanDTO();
		LoanDTO.setLoanAmount(Double.parseDouble(this.view.getLoanAmountField().getText()));
		LoanDTO.setInterestRate(this.view.getAddressField().getText());
		LoanDTO.setPhoneNumber(this.view.getPhoneField().getText());
		try {
			this.createService.call(LoanDTO);
			this.parentController.refreshTableData();
			this.view.showSuccessMessage("Branch created successfully");
			this.view.dispose();
		}catch(Exception e) {
			this.view.showErrorMessage(e.getMessage());
		}
	}
	
}
