package Controller;

import DTO.AccountDTO;
import Service.AccountCreateService;
import View.AccountCreateForm;

public class AccountCreateController extends BaseController {
	
	private AccountCreateForm view ;
	private AccountCreateService createService;
	private AccountListingController parentController;
	
	public AccountCreateController(AccountListingController parentController) {
		super(new AccountCreateForm());
		this.parentController = parentController;
		this.authenticate();
	}
	
	public void handleEmployeeRegisteration() {
		AccountDTO AccountDTO = new AccountDTO();
		AccountDTO.setAccountNumber(this.view.getNumberField().getText());
		AccountDTO.setAccountType(this.view.getAccountType());
		AccountDTO.setBalance(Double.parseDouble(this.view.getBalanceField().getText()));
		AccountDTO.setBranch(this.view.getBranch());
		AccountDTO.setCustomer(this.view.getCustomer());
		try {
			System.out.print("before service call");
			this.createService.call(AccountDTO);
			System.out.print("after service call");
			this.parentController.refreshTableData();
			this.view.showSuccessMessage("Account Register successfully");
			this.view.dispose();
		}
		catch(Exception e) {
			this.view.showErrorMessage(e.getMessage());
		}
	}

	@Override
	public void initController() {
		this.view = (AccountCreateForm) this.getView();
		this.view.getCreateButton().addActionListener(e -> handleEmployeeRegisteration());
		this.createService = new AccountCreateService();
	}
}
