package Controller;

import java.util.List;

import javax.swing.JOptionPane;

import Dao.AccountDaoImpl;
import Dao.AccountDaoImpl;
import Model.Account;
import View.AccountListingPage;
import View.AccountListingPage;

public class AccountListingController extends BaseController {
	
	private AccountListingPage view;
	private AccountDaoImpl accountDao;
	
	public AccountListingController() {
		super(new AccountListingPage());
		this.accountDao = new AccountDaoImpl();
		this.authenticate();
	}

	@Override
	public void initController() {
		this.view = (AccountListingPage) this.getView();
		
		String[] columns = this.view.getColumns();
		this.view.createDataTable(getAccountData(),columns);
		
		this.view.getCreateButton().addActionListener(e -> handleCreateButton());
		this.view.getUpdateButton().addActionListener(e -> handleUpdateButton());
		this.view.getDeleteButton().addActionListener(e -> handleDeleteButton());
		
	}
	
	private void handleDeleteButton() {
		
		 int selectedRowIndex = getSelectedRow();

		 if (selectedRowIndex == -1) {
			 JOptionPane.showMessageDialog(this.view, "Please select a employee to delete.");
			 return;
		 }

		 int employeeId = getemployeeIdFromSelectedRow(selectedRowIndex);

		 if (confirmDeletion(employeeId)) {
			 deleteEmployeeAndRefresh(employeeId);
		 }
	}
	
	private void handleUpdateButton() {

	}

	private void handleCreateButton() {
		
	}
	
	public String[][] getAccountData(){
		List<Account> Accounts = accountDao.getAll();
		String[][] AccountArray = new String[Accounts.size()][this.view.getColumns().length];
		int rowCount = 0;
		for(Account Account : Accounts) {
			AccountArray[rowCount][0] = Account.getId()+""; 
			AccountArray[rowCount][1] = Account.getaccountNumber();
			AccountArray[rowCount][2] = Account.getaccountType();
			AccountArray[rowCount][3] = Account.getBalance()+"";
			AccountArray[rowCount][4] = Account.getcreatedAt()+"";
			AccountArray[rowCount][5] = Account.getBranch().toString();
			AccountArray[rowCount][6] = Account.getCustomer().getfirstName();
			rowCount++;
		}
		return AccountArray;
	}
	
	private int getSelectedRow() {
		return this.view.getDataTableTemplate().getSelectedRow();
	}


private int getemployeeIdFromSelectedRow(int rowIndex) {
		return Integer.parseInt(getEmployeeData()[rowIndex][0]);
	}


private boolean confirmDeletion(int employeeId) {
		int response = JOptionPane.showConfirmDialog(
				this.view,
				"Are you sure you want to delete employee with ID " + employeeId + "?",
				"Confirm Deletion",
				JOptionPane.YES_NO_OPTION
	 );
		return response == JOptionPane.YES_OPTION;
	}
	
private void deleteEmployeeAndRefresh(int employeeId) {
		 employeeDao.delete(employeeId);
		 this.refreshTableData();
		}

public void refreshTableData() {
	this.view.refreshDataTable(getEmployeeData());
}
	
}
